{"version":3,"file":"app.js","sources":["../../../kan-vitejs/js/helpers/autoInit.js","../../../kan-vitejs/js/helpers/hmr.js","../../../kan-vitejs/js/modules/header.js","../../../kan-vitejs/js/app.js"],"sourcesContent":["export class AutoInitializer {\n  #modules\n  #instances = new Map()\n  #isRefreshing = false\n\n  constructor(modules = []) {\n    this.#modules = modules\n    this.initialize()\n  }\n\n  async initialize() {\n    try {\n      await Promise.all(this.#modules.map(Module => this.initializeModule(Module)))\n      !this.#isRefreshing && this.#instances.size === this.#modules.length && \n        console.log('ðŸ”§ [ App ] Modules initialized')\n        console.log('--------------------')\n    } catch (error) {\n      console.error('Error initializing modules:', error)\n    }\n  }\n\n  async initializeModule(Module) {\n    try {\n      await this.destroyModule(Module)\n      const instance = new Module()\n      typeof instance.init === 'function' && await instance.init()\n      this.#instances.set(Module, instance)\n      return instance\n    } catch (error) {\n      console.error(`Module ${Module.name} failed:`, error)\n      return null\n    }\n  }\n\n  async destroyModule(Module) {\n    const instance = this.#instances.get(Module)\n    if (!instance) return\n\n    try {\n      typeof instance.destroy === 'function' && await Promise.resolve(instance.destroy())\n\n      Object.entries(instance)\n        .filter(([_, val]) => val && typeof val === 'number')\n        .forEach(([_, timer]) => {\n          clearTimeout(timer)\n          clearInterval(timer)\n        })\n\n      Object.getOwnPropertySymbols(instance).forEach(field => instance[field] = null)\n      this.#instances.delete(Module)\n      await new Promise(resolve => setTimeout(resolve, 50))\n    } catch (error) {\n      console.error(`Error destroying module ${Module.name}:`, error)\n    }\n  }\n\n  async refreshModules() {\n    if (this.#isRefreshing) return\n    \n    try {\n      this.#isRefreshing = true\n      await Promise.all([...this.#instances.keys()].map(Module => this.destroyModule(Module)))\n      this.#instances.clear()\n      await new Promise(resolve => setTimeout(resolve, 50))\n      await this.initialize()\n    } catch (error) {\n      console.error('Error refreshing modules:', error)\n    } finally {\n      this.#isRefreshing = false\n    }\n  }\n}","export class HMRHelper {\n  constructor(autoInitializer) {\n    this.autoInitializer = autoInitializer\n    this.setupHMR()\n  }\n\n  setupHMR() {\n    if (!import.meta.hot) return\n\n    // Listen for updates but don't accept them\n    import.meta.hot.on('vite:beforeUpdate', ({ updates }) => {\n      const jsUpdates = updates.filter(update => update.path.endsWith('.js'))\n      if (jsUpdates.length) {\n        console.log(` [ HMR ] Update for: ${jsUpdates[0].path}`)\n        this.autoInitializer?.refreshModules()\n      }\n    })\n  }\n}\n","export default class Header {\n  #header\n  #scrollThreshold = 100\n  #scrolled = false\n  #observer\n  #timer\n  #boundHandleScroll\n  static #initialized = false\n\n  constructor() {\n    if (Header.#initialized) return\n    Header.#initialized = true\n    \n    this.#header = document.querySelector('header')\n    if (!this.#header) {\n      console.warn('Header element not found in the DOM')\n      return\n    }\n    this.#boundHandleScroll = this.#handleScroll.bind(this)\n    //this.#timer = setTimeout(() => (console.log('[testing | timeout]'), this.#timer = null), 2000);\n  }\n\n  async init() {\n    if (!this.#header) return\n    this.#observer = new IntersectionObserver(entries => this.#handleIntersection(entries), { threshold: [0, 0.5, 1] })\n    this.#observer.observe(this.#header)\n    this.#setupEventListeners()\n  }\n\n  destroy() {\n    Header.#initialized = false\n    this.#timer && (clearTimeout(this.#timer), this.#timer = null)\n    this.#observer && (this.#observer.disconnect(), this.#observer = null)\n    this.#boundHandleScroll && (window.removeEventListener('scroll', this.#boundHandleScroll), this.#boundHandleScroll = null)\n    this.#header && (this.#header.classList.remove('visible', 'scrolled'), this.#header = null)\n  }\n\n  #handleIntersection = entries => {\n    if (!this.#header) return\n    entries.forEach(entry => \n      this.#header.classList.toggle('visible', entry.isIntersecting)\n    )\n  }\n\n  #setupEventListeners = () => \n    window.addEventListener('scroll', this.#boundHandleScroll, { passive: true })\n\n  #handleScroll = () => {\n    if (!this.#header) return\n    const shouldBeScrolled = window.scrollY > this.#scrollThreshold\n    if (shouldBeScrolled !== this.#scrolled) {\n      this.#scrolled = shouldBeScrolled\n      this.#header.classList.toggle('scrolled', shouldBeScrolled)\n    }\n  }\n}","import '../css/style.css'\nimport { AutoInitializer } from './helpers/autoInit'\nimport { HMRHelper } from './helpers/hmr'\nimport Header from './modules/header'\n\nclass App {\n  static instance = null\n  \n  constructor() {\n    if (App.instance) return App.instance\n    this.modules = [Header]\n    this.init()\n    App.instance = this\n  }\n\n  init() {\n    this.autoInitializer = new AutoInitializer(this.modules)\n    new HMRHelper(this.autoInitializer)\n    console.log('--------------------')\n    console.log('ðŸ’¡ [ App ] initialize ')\n  }\n\n  registerModule(module) {\n    this.modules.push(module)\n    this.autoInitializer.initializeModule(module)\n  }\n}\n\nconst app = new App()\n\nif (import.meta.hot) {\n  import.meta.hot.accept(() => {\n    console.clear();\n    console.log('--------------------')\n    console.log('[ HMR ] Hot updating app.js')\n  })\n}\n\nexport default app\n"],"names":["AutoInitializer","modules","__privateAdd","_modules","_instances","_isRefreshing","__privateSet","__privateGet","Module","error","instance","_","val","timer","field","resolve","HMRHelper","autoInitializer","_Header","_header","_scrollThreshold","_scrolled","_observer","_timer","_boundHandleScroll","_handleIntersection","entries","entry","_setupEventListeners","_handleScroll","shouldBeScrolled","_initialized","Header","_App","module","__publicField","App"],"mappings":"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"}